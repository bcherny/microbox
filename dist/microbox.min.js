function $(t,n){var i=t.charAt(0),r=s[i],e=(n||document)["getElement"+(r||"sByTagName")](t.slice(r?1:0));return"#"===i?[e]:e}(function(){"use strict";var t=document,n=window,i=Array.prototype,r=Element.prototype,e=document.createElement("b"),o=[],s=["(^|\\s)","(?:\\s|$)"];e.classList||(r.classList={add:function(t){return this.className+=" "+t,this},contains:function(t){return this.className.indexOf(t)>-1},remove:function(t){var n=this;return n.className=n.className.replace(RegExp(s[0]+t+s[1]),"$1"),n},toggle:function(t){var n=this.classList;return n[n.contains("className")?"remove":"add"](t)}}),t.addEventListener||(t.addEventListener=n.addEventListener=r=function(t,n){this.attachEvent("on"+t,n)}),o.filter||(i.filter=function(t){if(null===this)throw new TypeError;var n=Object(this),i=n.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=[],e=arguments[1],o=0;i>o;o++)if(o in n){var s=n[o];t.call(e,s,o,n)&&r.push(s)}return r}),o.forEach||(i.forEach=function(t,n){for(var i=n||this,r=0,e=this.length;e>r;++r)t.call(i,this[r],r,this)}),o.indexOf||(i.indexOf=function(t){if(null===this)throw new TypeError;for(var n=this.length;n--;)if(t===this[n])return n;return-1})})();var s={"#":"ById",".":"sByClassName"},_=function(){"use strict";var t={isFunction:function(t){return"function"==typeof t},isNull:function(t){return null===t},isString:function(t){return"string"==typeof t},isUndefined:function(t){return t===void 0},toArray:function(t){return[].slice.call(t)}};return t}(),template={options:{},container:function(t,n){var i=document.createElement("div"),r=this.options;return i.className=r.classes.lightbox,i.id=r.ids.lightboxPrefix+t,i.innerHTML=n,i},images:function(t,n,i){var r=this.options.classes,e=i&&i[0]?'<div class="'+r.caption+'"><span class="'+r.captionTrigger+'">i</span>'+i[0]+"</div>":"";return['<div class="'+r.lightboxInner+'">','<img src="'+n[0]+'" alt="'+t+'" class="'+r.imageCurrent+'" />',"</div>",e].join("")},setOptions:function(t){this.options=t}},Microbox=function(){function t(t){function a(t,n,i,r){f(t,n)||(I[t].push(n),d(t),C[t].push(i),r&&r.setAttribute(A.attrs.lightboxPage,I[t].length-1),E(t))}function c(t){H[t]=0,I[t]=[]}function u(t){g(t)||c(t)}function l(t){return I[t]}function f(t,n){return I[t].indexOf(n)>-1}function g(t){return t in I}function h(t){C[t]=[]}function d(t){p(t)||h(t)}function p(t){return t in C}function v(t){return C[t]}function m(){for(var t in I)x(t);S=null}function x(t){y(t).classList.remove(A.classes.showingLightbox)}function b(t){y(t).classList.add(A.classes.showingLightbox),w(t)}function y(t){return $("#"+A.ids.lightboxPrefix+t)[0]}function L(t){return!!y(t)}function w(t){var n=y(t),i=$("img",n)[0],e=$("."+A.classes.lightboxInner,n)[0],o=i.offsetHeight,s=r();e.style["margin-top"]=(s-o)/2+"px"}function E(t){var n=v(t),i=l(t),r=template.images(t,i,n);if(L(t)){var e=y(t);document.body.removeChild(e)}var s=template.container(t,r);o.body.appendChild(s),B[t]=y(t)}function T(t){var n={document:{fn:function(){m()},yep:function(){var n=A.classes,i=t.target.classList;return!i.contains(n.captionTrigger)&&!i.contains(n.caption)}},caption:{fn:function(){var n=A.classes,i=n.showingCaption,o=t.target,s=e(o,function(t){return t.classList.contains(n.lightbox)});s.classList.toggle(i);var a=o.parentNode,c=a.offsetHeight,u=r();a.style.top=(s.classList.contains(i)?u-c:u)+"px"},yep:function(){return t.target.classList.contains(A.classes.captionTrigger)}},trigger:{fn:function(){i(t);var n=this.yep(),r=n.getAttribute(A.attrs.lightboxTrigger);r===S?(S=null,x(r)):(m(),S=r,b(r))},yep:function(){return e(t.target,function(t){return t.classList.contains(A.classes.lightboxTrigger)})}}};for(var o in n){var s=n[o];s.yep()&&s.fn()}}function N(){var t=S;_.isUndefined(t)||_.isNull(t)||w(t)}function O(){var t=n();t.forEach(function(t){var n=t.href,i=A.ids.lightboxPrefix+M,r=t.title;++M,t.setAttribute(A.attrs.lightboxTrigger,i),t.classList.add(A.classes.lightboxTrigger),P(i,n,r,t)})}function P(t,n,i,r){_.isString(n)&&(n=[n]),_.isString(i)&&(i=[i]),u(t),n.forEach(function(n,e){a(t,n,i[e],r)})}var A={classes:{caption:"caption",captionTrigger:"microbox-caption-trigger",imageCurrent:"cur",lightbox:"microbox",lightboxInner:"inner",lightboxTrigger:"microbox-trigger",showingCaption:"show-caption",showingLightbox:"show-microbox"},attrs:{lightboxPage:"data-microbox-page",lightboxTrigger:"data-microbox-trigger"},ids:{lightboxPrefix:"microbox-"}},C={},H={},I={},B={},M=0,S=null;if(t)for(var U in t)A.hasOwnProperty(U)&&(A[U]=t[U]);template.setOptions(A),O(),o.addEventListener("click",T),s.addEventListener("resize",N)}function n(){return _.toArray($("a")).filter(function(t){return t.rel.match(a)})}function i(t){t&&(t.preventDefault(),t.stopPropagation())}function r(){return s.innerHeight||o.body.clientHeight}function e(t,n){function i(t){return _.isUndefined(t.documentElement)&&"HTML"!==t.tagName}if(_.isFunction(n)){do{if(n(t))return t;t=t.parentNode}while(i(t))}else do{var r=0,e=0;for(var o in n)n[o]==t[o]&&++r,++e;if(r===e)return t;t=t.parentNode}while(i(t));return!1}var o=document,s=window,a=/^lightbox/;return t}();