!function(a,b){"object"==typeof exports?module.exports=b(require("umodel"),require("u")):"function"==typeof define&&define.amd?define("microbox",["umodel","u"],b):a.microbox=b(a.umodel,a.u)}(this,function(a,b){var c,d,e;return e=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(e="",q=a.images,k=0,n=q.length;n>k;k++)j=q[k],e+='<img src="'+j+'" alt="" />';for(d="",r=a.captions,h=l=0,o=r.length;o>l;h=++l)c=r[h],c&&(d+='<div class="caption" microbox-caption="'+h+'">\n	<span class="microbox-button" microbox-trigger-caption>i</span>\n	'+c+"\n</div>");if(a.images.length>1){for(g="",s=a.images,h=m=0,p=s.length;p>m;h=++m)f=s[h],g+='<li microbox-trigger-set="'+b+'" microbox-trigger-index="'+h+'">'+(h+1)+"</li>";i='<ul class="microbox-pager">\n	<li class="microbox-counts">'+(a.active+1)+"/"+a.images.length+'</li>\n	<li microbox-trigger-prev microbox-trigger-set="'+b+'">&#9656;</li>\n	'+g+'\n	<li microbox-trigger-next microbox-trigger-set="'+b+'">&#9656;</li>\n</ul>'}else i="";return'<span class="microbox-button microbox-close" microbox-close>&times;</span>\n<div class="inner">\n	'+e+"\n</div>\n"+d+"\n"+i},c=function(a,b,c){return b>a?a=b:a>c&&(a=c),a},d=function(){var d,f,g,h,i,j;return f=-1,h=new a({visible:null,sets:{}}),g=function(){for(;!(++f in h.get("sets"));)return f},i=function(a,d,e){var f,g,i,j,k,l;return null==d&&(d=0),null==a?(console.error("microbox.toggle expects a set ID, given '"+a+"'"),!1):(k=h.get("sets/"+a),j=k.images.length-1,i=k.element,null==k?(console.error("microbox.toggle passed an invalid set id '"+a+"'"),!1):(d=c(+d,0,j),l=null!=e?"add":"toggle",b.classList[l](i,"visible"),b.classList.contains(i,"visible")?(g=k.components,b.each(g.images,function(a){return b.classList.remove(a,"visible")}),b.classList.add(g.images[d],"visible"),g.counts.innerHTML=""+(d+1)+"/"+k.images.length,b.each(g.pagerItems,function(a){return b.classList.remove(a,"active")}),b.classList.add(g.pagerItems[d],"active"),l=0===d?"add":"remove",b.classList[l](g.prev,"disabled"),l=d===j?"add":"remove",b.classList[l](g.next,"disabled"),b.each(g.captions,function(a){return b.classList.add(a,"hide"),b.classList.remove(a,"active"),a.style.top=""}),g.pager.style.bottom="",f=g.captions[d],f&&b.classList.remove(f,"hide"),k.active=d,h.set("visible",i)):h.set("visible",null)))},d=function(a,b){var c,d;return d=h.get("sets/"+a),c=d.triggers.indexOf(b),b.addEventListener("click",function(b){return b.preventDefault(),i(a,c)})},j=document.querySelectorAll('a[href][rel^="lightbox"]'),b.each(j,function(a){var b,c,e,f,i,j;return b=a.getAttribute("href"),f=a.getAttribute("rel"),j=a.getAttribute("title")||"",e=f.split("["),c=e[1]?e[1].slice(0,-1):g(),i=h.get("sets/"+c),i?i.triggers.indexOf(a)<0&&(i.captions.push(j),i.images.push(b),i.triggers.push(a)):h.set("sets/"+c,{captions:[j],images:[b],triggers:[a],active:0}),d(c,a)}),b.each(h.get("sets"),function(a,c){var d,f;return f=e(a,c),d=document.createElement("div"),d.className="microbox",d.innerHTML=f,document.body.appendChild(d),a=h.get("sets/"+c),a.element=d,a.components={captions:[],counts:d.querySelector(".microbox-counts"),images:d.querySelectorAll("img"),pager:d.querySelector(".microbox-pager"),pagerItems:d.querySelectorAll("[microbox-trigger-index]"),next:d.querySelector("[microbox-trigger-next]"),prev:d.querySelector("[microbox-trigger-prev]")},b.each(d.querySelectorAll("[microbox-caption]"),function(b){return c=+b.getAttribute("microbox-caption"),a.components.captions[c]=b})}),document.addEventListener("click",function(a){var c,d,e,f,g,j,k,l,m,n;return l=a.target,b.classList.contains(l,"inner")||l.hasAttribute("microbox-close")?(n=h.get("visible"),b.classList.remove(n,"visible"),h.set("visible",null)):l.hasAttribute("microbox-trigger-index")&&l.hasAttribute("microbox-trigger-set")?(k=l.getAttribute("microbox-trigger-set"),e=l.getAttribute("microbox-trigger-index"),i(k,e,!0)):l.hasAttribute("microbox-trigger-next")||l.hasAttribute("microbox-trigger-prev")?(k=l.getAttribute("microbox-trigger-set"),e=h.get("sets/"+k+"/active"),l.hasAttribute("microbox-trigger-next")?++e:--e,i(k,e,!0)):l.hasAttribute("microbox-trigger-caption")?(c=l.parentNode,d=c.offsetHeight,j=window.innerHeight,m=c.style.top,g=c.parentNode.querySelector(".microbox-pager"),m&&parseInt(m,10)!==j?(b.classList.remove(c,"active"),c.style.top="",g.style.bottom=""):(f=j-d,c.style.top=""+f+"px",b.classList.add(c,"active"),g.style.bottom=""+(d+10)+"px")):void 0})}()});