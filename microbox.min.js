(function(e,t){"object"==typeof exports?module.exports=t(require("umodel"),require("_")):"function"==typeof define&&define.amd?define("microbox",["umodel","_"],t):e.microbox=t(e.umodel,e._)})(this,function(e,t){var i,r,o;return o=function(e,t){var i,r,o,s,n,c,l,a,g,u,m,b,d,p,x,v,f;for(o="",x=e.images,g=0,b=x.length;b>g;g++)a=x[g],o+='<img src="'+a+'" alt="" />';for(r="",v=e.captions,c=u=0,d=v.length;d>u;c=++u)i=v[c],i&&(r+='<div class="caption" microbox-caption="'+c+'">\n	<span class="microbox-button" microbox-trigger-caption>i</span>\n	'+i+"\n</div>");if(e.images.length>1){for(n="",f=e.images,c=m=0,p=f.length;p>m;c=++m)s=f[c],n+='<li microbox-trigger-set="'+t+'" microbox-trigger-index="'+c+'">'+(c+1)+"</li>";l='<ul class="microbox-pager">\n	<li class="microbox-counts">'+(e.active+1)+"/"+e.images.length+'</li>\n	<li microbox-trigger-prev microbox-trigger-set="'+t+'">&#9656;</li>\n	'+n+'\n	<li microbox-trigger-next microbox-trigger-set="'+t+'">&#9656;</li>\n</ul>'}else l="";return'<span class="microbox-button microbox-close" microbox-close>&times;</span>\n<div class="inner">\n	'+o+"\n</div>\n"+r+"\n"+l},i=function(e,t,i){return t>e?e=t:e>i&&(e=i),e},r=function(){var r,s,n,c,l,a;return s=-1,c=new e({visible:null,sets:{}}),n=function(){for(;!(++s in c.get("sets"));)return s},l=function(e,r,o){var s,n,l,a,g,u;return null==r&&(r=0),null==e?(console.error("microbox.toggle expects a set ID, given '"+e+"'"),!1):(g=c.get("sets/"+e),a=g.images.length-1,l=g.element,null==g?(console.error("microbox.toggle passed an invalid set id '"+e+"'"),!1):(r=i(+r,0,a),u=null!=o?"add":"toggle",t.classList[u](l,"visible"),t.classList.contains(l,"visible")?(n=g.components,t.each(n.images,function(e){return t.classList.remove(e,"visible")}),t.classList.add(n.images[r],"visible"),n.counts.innerHTML=""+(r+1)+"/"+g.images.length,t.each(n.pagerItems,function(e){return t.classList.remove(e,"active")}),t.classList.add(n.pagerItems[r],"active"),u=0===r?"add":"remove",t.classList[u](n.prev,"disabled"),u=r===a?"add":"remove",t.classList[u](n.next,"disabled"),t.each(n.captions,function(e){return t.classList.add(e,"hide"),t.classList.remove(e,"active"),e.style.top=""}),n.pager.style.bottom="",s=n.captions[r],s&&t.classList.remove(s,"hide"),g.active=r,c.set("visible",l)):c.set("visible",null)))},r=function(e,t){var i,r;return r=c.get("sets/"+e),i=r.triggers.indexOf(t),t.addEventListener("click",function(t){return t.preventDefault(),l(e,i)})},a=document.querySelectorAll('a[href][rel^="lightbox"]'),t.each(a,function(e){var t,i,o,s,l,a;return t=e.getAttribute("href"),s=e.getAttribute("rel"),a=e.getAttribute("title")||"",o=s.split("["),i=o[1]?o[1].slice(0,-1):n(),l=c.get("sets/"+i),l?0>l.triggers.indexOf(e)&&(l.captions.push(a),l.images.push(t),l.triggers.push(e)):c.set("sets/"+i,{captions:[a],images:[t],triggers:[e],active:0}),r(i,e)}),t.each(c.get("sets"),function(e,i){var r,s;return s=o(e,i),r=document.createElement("div"),r.className="microbox",r.innerHTML=s,document.body.appendChild(r),e=c.get("sets/"+i),e.element=r,e.components={captions:[],counts:r.querySelector(".microbox-counts"),images:r.querySelectorAll("img"),pager:r.querySelector(".microbox-pager"),pagerItems:r.querySelectorAll("[microbox-trigger-index]"),next:r.querySelector("[microbox-trigger-next]"),prev:r.querySelector("[microbox-trigger-prev]")},t.each(r.querySelectorAll("[microbox-caption]"),function(t){return i=+t.getAttribute("microbox-caption"),e.components.captions[i]=t})}),document.addEventListener("click",function(e){var i,r,o,s,n,a,g,u,m,b;return u=e.target,t.classList.contains(u,"inner")||u.hasAttribute("microbox-close")?(b=c.get("visible"),t.classList.remove(b,"visible"),c.set("visible",null)):u.hasAttribute("microbox-trigger-index")&&u.hasAttribute("microbox-trigger-set")?(g=u.getAttribute("microbox-trigger-set"),o=u.getAttribute("microbox-trigger-index"),l(g,o,!0)):u.hasAttribute("microbox-trigger-next")||u.hasAttribute("microbox-trigger-prev")?(g=u.getAttribute("microbox-trigger-set"),o=c.get("sets/"+g+"/active"),u.hasAttribute("microbox-trigger-next")?++o:--o,l(g,o,!0)):u.hasAttribute("microbox-trigger-caption")?(i=u.parentNode,r=i.offsetHeight,a=window.innerHeight,m=i.style.top,n=i.parentNode.querySelector(".microbox-pager"),m&&parseInt(m,10)!==a?(t.classList.remove(i,"active"),i.style.top="",n.style.bottom=""):(s=a-r,i.style.top=""+s+"px",t.classList.add(i,"active"),n.style.bottom=""+(r+10)+"px")):void 0})}()});